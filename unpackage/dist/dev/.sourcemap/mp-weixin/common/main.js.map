{"version":3,"sources":["uni-app:///main.js",null,"webpack:///C:/Users/44553/Desktop/微信图片视频/备份代码/66_Chargingpile_applet_2.0/App.vue?8b61","uni-app:///App.vue","webpack:///C:/Users/44553/Desktop/微信图片视频/备份代码/66_Chargingpile_applet_2.0/App.vue?8110","webpack:///C:/Users/44553/Desktop/微信图片视频/备份代码/66_Chargingpile_applet_2.0/App.vue?4ee0"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","Vue","config","productionTip","prototype","$base","Base","mixin","share","App","mpType","app","$mount","globalData","scanParams","onLaunch","onShow","onHide","methods","handleScanParams","device","port","console","isFromScan","timestamp","scene","isScanScene","hasQuery","clearUserRelatedStorage","uni","refreshCurrentPageData","setTimeout","refreshIndexPage","page","refreshChargingzhongPage","refreshSmchargingPage","refreshGenericPage","refreshCurrentPageAfterUserSwitch","refreshIndexPageUserInfo","vm","refreshChargingzhongPageUserInfo","refreshSmchargingPageUserInfo","forceReloadCurrentPage","currentRoute","url","pad","num","len","handleLoggedUserScan","success","code","deviceId","method","data","header","posterList","processedPort","fail","loginUrl"],"mappings":";;;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AACA;AAAqC;AAAA;AAJrC;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAK1DC,YAAG,CAACC,MAAM,CAACC,aAAa,GAAG,KAAK;AAChCF,YAAG,CAACG,SAAS,CAACC,KAAK,GAAC,IAAIC,UAAI,EAAE;AAC9BL,YAAG,CAACM,KAAK,CAACC,cAAK,CAAC;AAChBC,YAAG,CAACC,MAAM,GAAG,KAAK;AAClB,IAAMC,GAAG,GAAG,IAAIV,YAAG,iCACZQ,YAAG;EAACD,KAAK,EAALA;AAAK,GACd;AACF,UAAAG,GAAG,EAACC,MAAM,EAAE,C;;;;;;;;;;;;;ACdZ;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACuD;AACL;AACa;;;AAG/D;AACoM;AACpM,gBAAgB,yMAAU;AAC1B,EAAE,yEAAM;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAwvB,CAAgB,yvBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;ACC5wB;AAAA;AAAA;AAAA,eAEA;EACAC;IACAC;EACA;;EACAC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA;IACA;EACA;EACAC;IACA;IACA;IACA;;IAEA;IACA;IACA;MACA;IACA;EACA;EACAC,2BACA;EAEAC;IACA;IACAC;MACA;QACA;MACA;;MAEA;MACA;;MAEA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QAEA;UACAC;UACAC;UACAC;QACA;UACA;UACA;UACA;YACA;YACAF;YACAC;UAEA;QACA;MACA;MACA;MAAA,KACA;QACAD;QACAC;MAEA;;MAEA;MACA;QAGA;QACA,kCACA,gDACA;UACAC;UACA;QACA;;QAEA;QACA;UACAF;UACAC;UACAE;UACAC;QACA;;QAEAF;;QAEA;QACA;QACA;QAEA;UACAA;UACA;QACA;UACAA;QACA;MACA;QACAA;UACAF;UACAC;UACAI;UACAC;UACAC;QACA;MACA;IACA;IAEA;IACAC;MACAN;;MAEA;MACAO;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;;MAEA;MACA;QACA;QACA;QACAA;QACAA;QACAP;MACA;;MAEA;MACAO;MACAA;MAEAP;IACA;IAEA;IACAQ;MAAA;MACAR;;MAEA;MACA;MACA;QACAA;QACA;MACA;MAEA;MACA;MAEAA;;MAEA;MACAS;QACA;QACA;UACAT;UACA;QACA;UACAA;UACA;QACA;UACAA;UACA;QACA;UACAA;UACA;QACA;MACA;IACA;IAEA;IACAU;MACA;QACAV;QACA;QACA;UACAW;QACA;QACA;QACA;UACAA;QACA;QACA;QACA;UACAA;QACA;QACA;QACA;UACAA;QACA;MACA;IACA;IAEA;IACAC;MACA;QACAZ;QACA;QACA;UACAW;QACA;QACA;UACAA;QACA;QACA;UACAA;QACA;QACA;QACA;UACAA;QACA;QACA;QACA;UACAA;QACA;MACA;IACA;IAEA;IACAE;MACA;QACAb;QACA;QACA;UACAW;QACA;QACA;QACA;UACAA;QACA;QACA;QACA;UACAA;QACA;MACA;IACA;IAEA;IACAG;MACA;QACAd;QACA;QACA;UACAW;QACA;UACAA;QACA;QACA;QACA;UACAA;QACA;MACA;IACA;IAEA;IACAI;MAAA;MACAf;;MAEA;MACA;MACA;MACAA;MACAA;MAEA;MACA;QACAA;QACA;MACA;MAEA;MACA;MAEAA;MAEA;QACA;QACAS;UACA;UACA;UACAT;;UAEA;UACA;YACAA;YACA;UACA;YACAA;YACA;UACA;YACAA;YACA;UACA;QACA;MACA;IACA;IAEA;IACAgB;MACA;QACA;QACA;QACA;QAEAhB;QACAA;;QAEA;QACAiB;QACAA;;QAEA;QACAR;UACA;YACAT;YACAiB;UACA;QACA;;QAEA;QACA;UACAR;YACAQ;UACA;QACA;QAEA;UACAR;YACAQ;UACA;QACA;;QAEA;QACA;UACAA;QACA;QAEAjB;MACA;QACAA;MACA;IACA;IAEA;IACAkB;MACA;QACAlB;;QAEA;QACA;UACAiB;QACA;;QAEA;QACA;UACAR;YACAQ;UACA;QACA;;QAEA;QACA;UACAA;QACA;QAEAjB;MACA;QACAA;MACA;IACA;IAEA;IACAmB;MACA;QACAnB;;QAEA;QACA;UACAiB;QACA;;QAEA;QACA;UACAA;QACA;QAEAjB;MACA;QACAA;MACA;IACA;IAIA;IACAoB;MACApB;MAEA;MACA;QACAA;QACA;MACA;MAEA;MACA;MAEAA;;MAEA;MACA,4CACAqB,kDACAA;QAEArB;QACAO;UACAe;QACA;MACA;QACAtB;QACA;QACA;QACAO;UACAe;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;QACAC;QACAC;MACA;MACA;IACA;IAEA;IACAC;MAAA;MACA1B;;MAEA;MACA;MACAA;;MAEA;MACAO;QACAoB;UACA3B;;UAEA;UACA;YACA4B;YACAC;UACA;;UAEA7B;;UAEA;UACAO;YACAe;YACAQ;YACAC;YACAC;cACA;YACA;YACAL;cACA3B;cAEA;gBACA;gBACA;gBAEAA;gBACAA;;gBAEA;gBACA;kBACAA;;kBAEA;kBACA;gBACA;kBACAA;gBACA;;gBAEA;gBACAO;gBACAA;gBACAA;gBACAA;gBACAA;gBACAA;gBACAA;gBAEAP;;gBAEA;gBACA;gBACAO;gBACA;gBACAA;;gBAEA;gBACA;kBACA;kBACA;oBACA0B;kBACA;kBACA1B;gBACA;kBACAA;gBACA;gBAEAP;;gBAEA;gBACA;kBACAA;;kBAEA;kBACA;oBACA;oBACA;oBACA;sBACA;wBACAkC;sBACA;wBACAlC;wBACAkC;sBACA;oBACA;sBACAA;oBACA;oBAEA;oBACAlC;;oBAEA;oBACAS;sBACAT;sBACAO;wBACAe;wBACAK;0BACA3B;wBACA;wBACAmC;0BACAnC;wBACA;sBACA;oBACA;kBACA;oBACAA;kBACA;gBACA;kBACAA;gBACA;cACA;gBACAA;;gBAEA;gBACA;gBACA;kBACAoC;kBACApC;gBACA;;gBAEA;gBACA;;gBAEA;gBACAS;kBACAF;oBACAe;oBACAK;sBACA3B;oBACA;oBACAmC;sBACAnC;sBACA;sBACAA;sBACAO;wBACAe;wBACAK;0BACA3B;wBACA;wBACAmC;0BACAnC;wBACA;sBACA;oBACA;kBACA;gBACA;cACA;gBACAA;gBACAA;;gBAEA;gBACA;gBACA;kBACAoC;kBACApC;kBACAA;gBACA;kBACAA;gBACA;;gBAEA;gBACA;gBAEAA;gBACA;gBACA;gBACAS;kBACAF;oBACAe;oBACAK;sBACA3B;oBACA;oBACAmC;sBACAnC;sBACA;sBACAA;sBACAO;wBACAe;wBACAK;0BACA3B;wBACA;wBACAmC;0BACAnC;wBACA;sBACA;oBACA;kBACA;gBACA;cACA;gBACAA;cACA;YACA;YACAmC;cACAnC;YACA;UACA;QACA;QACAmC;UACAnC;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AChqBA;AAAA;AAAA;AAAA;AAAwkC,CAAgB,siCAAG,EAAC,C;;;;;;;;;;;ACA5lC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"common/main.js","sourcesContent":["import 'uni-pages';\r\n// @ts-ignore\r\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import Vue from 'vue'\r\nimport App from './App'\r\nimport {Base} from \"./common/Base.js\"\r\nimport share from './common/share.js'\r\n\r\nVue.config.productionTip = false\r\nVue.prototype.$base=new Base()\r\nVue.mixin(share)\r\nApp.mpType = 'app'\r\nconst app = new Vue({\r\n    ...App,share\r\n})\r\napp.$mount()","var render, staticRenderFns, recyclableRender, components\nvar renderjs\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"App.vue\"\nexport default component.exports","import mod from \"-!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=script&lang=js&\"","<script>\r\n\timport {Config} from './common/Config.js'\r\n\r\n\texport default {\r\n\t\tglobalData: {\r\n\t\t\tscanParams: null // 存储扫码参数\r\n\t\t},\r\n\t\tonLaunch: function(options) {\r\n\t\t\t// if(!wx.cloud){\r\n\t\t\t// \tconsole.error('请使用2.3.3或以上的基础库以使用云能力')\r\n\t\t\t// }else{\r\n\t\t\t// \twx.cloud.init({\r\n\t\t\t// \t\tenv:'jump-4g7tz67x8afafdf2',\r\n\t\t\t// \t\ttraceUser:true,\r\n\t\t\t// \t})\r\n\t\t\t// }\r\n\r\n\t\t\t// 处理启动参数，可能包含扫码信息\r\n\t\t\tthis.handleScanParams(options);\r\n\t\t},\r\n\t\tonShow: function(options) {\r\n\t\t\t// uni.setEnableDebug({\r\n\t\t\t//     enableDebug: true\r\n\t\t\t// })\r\n\r\n\t\t\t// 只在应用启动时处理扫码参数，避免在页面切换时重复处理\r\n\t\t\t// 检查是否已经有扫码参数，如果有则不重复处理\r\n\t\t\tif (!this.globalData.scanParams) {\r\n\t\t\t\tthis.handleScanParams(options);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t},\r\n\r\n\t\tmethods: {\r\n\t\t\t// 处理扫码参数\r\n\t\t\thandleScanParams(options) {\r\n\t\t\t\tif (!options) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 检查是否有扫码场景值\r\n\t\t\t\tconst scene = options.scene;\r\n\r\n\t\t\t\t// 扫码场景值通常为1011, 1012, 1013, 1047, 1048, 1049\r\n\t\t\t\tconst scanScenes = [1011, 1012, 1013, 1047, 1048, 1049];\r\n\r\n\t\t\t\t// 获取query参数中的device和port\r\n\t\t\t\tlet device = '';\r\n\t\t\t\tlet port = '';\r\n\r\n\t\t\t\t// 检查是否从URL中获取参数 (如 https://test.yueguisuchong.com/ap3200/2824C905/FF)\r\n\t\t\t\tif (options.query && options.query.q) {\r\n\t\t\t\t\t// 解码URL\r\n\t\t\t\t\tconst url = decodeURIComponent(options.query.q);\r\n\r\n\t\t\t\t\t// 使用正则表达式匹配URL中的设备ID和端口号\r\n\t\t\t\t\t// 匹配形如 baseUrl/ap3200/2824C905/FF 的URL\r\n\t\t\t\t\tconst regex = /\\/([A-Fa-f0-9]{8})\\/([A-Fa-f0-9]{2})(?:\\/|$)/;\r\n\t\t\t\t\tconst match = url.match(regex);\r\n\r\n\t\t\t\t\tif (match && match.length >= 3) {\r\n\t\t\t\t\t\tdevice = match[1]; // 第一个捕获组是设备ID\r\n\t\t\t\t\t\tport = match[2];   // 第二个捕获组是端口号\r\n\t\t\t\t\t\tconsole.log('App正则匹配结果:', device, port);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 如果正则匹配失败，尝试使用分割方法\r\n\t\t\t\t\t\tconst urlParts = url.split('/');\r\n\t\t\t\t\t\tif (urlParts.length >= 2) {\r\n\t\t\t\t\t\t\t// 获取倒数第二个和最后一个参数\r\n\t\t\t\t\t\t\tdevice = urlParts[urlParts.length - 2];\r\n\t\t\t\t\t\t\tport = urlParts[urlParts.length - 1];\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 直接从参数中获取\r\n\t\t\t\telse if (options.query && options.query.device && options.query.port) {\r\n\t\t\t\t\tdevice = options.query.device;\r\n\t\t\t\t\tport = options.query.port;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 如果获取到了设备ID和端口号，并且是扫码进入的场景，则保存参数\r\n\t\t\t\tif (device && port && (scanScenes.includes(scene) || (options.query && options.query.q))) {\r\n\r\n\r\n\t\t\t\t\t// 检查是否已经有相同的扫码参数，避免重复设置\r\n\t\t\t\t\tif (this.globalData.scanParams &&\r\n\t\t\t\t\t\tthis.globalData.scanParams.device === device &&\r\n\t\t\t\t\t\tthis.globalData.scanParams.port === port) {\r\n\t\t\t\t\t\tconsole.log('App: 相同的扫码参数已存在，跳过设置');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 保存扫码参数到全局数据\r\n\t\t\t\t\tthis.globalData.scanParams = {\r\n\t\t\t\t\t\tdevice: device,\r\n\t\t\t\t\t\tport: port,\r\n\t\t\t\t\t\tisFromScan: true,\r\n\t\t\t\t\t\ttimestamp: Date.now() // 添加时间戳\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tconsole.log('App: 扫码参数已保存到全局数据');\r\n\r\n\t\t\t\t\t// 检查用户是否已经登录\r\n\t\t\t\t\tconst userToken = uni.getStorageSync('userToken');\r\n\t\t\t\t\tconst user = uni.getStorageSync('user');\r\n\r\n\t\t\t\t\tif (userToken && user) {\r\n\t\t\t\t\t\tconsole.log('用户已登录，通过外部扫码进入，调用wxlogin/applet接口');\r\n\t\t\t\t\t\tthis.handleLoggedUserScan(device);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('用户未登录，扫码参数已保存，等待登录流程处理');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('App: 未满足扫码参数保存条件', {\r\n\t\t\t\t\t\tdevice: device,\r\n\t\t\t\t\t\tport: port,\r\n\t\t\t\t\t\tscene: scene,\r\n\t\t\t\t\t\tisScanScene: scanScenes.includes(scene),\r\n\t\t\t\t\t\thasQuery: !!(options.query && options.query.q)\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 清除用户相关的本地存储\r\n\t\t\tclearUserRelatedStorage(oldUserId) {\r\n\t\t\t\tconsole.log('开始清除旧用户相关存储，用户ID:', oldUserId);\r\n\r\n\t\t\t\t// 清除用户基本信息\r\n\t\t\t\tuni.removeStorageSync('user');\r\n\t\t\t\tuni.removeStorageSync('userId');\r\n\t\t\t\tuni.removeStorageSync('userToken');\r\n\t\t\t\tuni.removeStorageSync('phone');\r\n\t\t\t\tuni.removeStorageSync('Name');\r\n\t\t\t\tuni.removeStorageSync('poster');\r\n\t\t\t\tuni.removeStorageSync('adunit');\r\n\t\t\t\tuni.removeStorageSync('posterList');\r\n\r\n\t\t\t\t// 清除用户特定的存储项\r\n\t\t\t\tif (oldUserId) {\r\n\t\t\t\t\tconst oldLogolist = \"logolist_\" + oldUserId;\r\n\t\t\t\t\tconst oldUsertype = 'type_' + oldUserId;\r\n\t\t\t\t\tuni.removeStorageSync(oldLogolist);\r\n\t\t\t\t\tuni.removeStorageSync(oldUsertype);\r\n\t\t\t\t\tconsole.log('清除旧用户特定存储:', oldLogolist, oldUsertype);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 清除其他可能的用户相关存储\r\n\t\t\t\tuni.removeStorageSync('PrevLoginPath');\r\n\t\t\t\tuni.removeStorageSync('JeepGetPhone');\r\n\r\n\t\t\t\tconsole.log('旧用户相关存储已清除完成');\r\n\t\t\t},\r\n\r\n\t\t\t// 刷新当前页面数据\r\n\t\t\trefreshCurrentPageData() {\r\n\t\t\t\tconsole.log('开始刷新当前页面数据');\r\n\r\n\t\t\t\t// 获取当前页面栈\r\n\t\t\t\tconst pages = getCurrentPages();\r\n\t\t\t\tif (pages.length === 0) {\r\n\t\t\t\t\tconsole.log('没有当前页面，跳过刷新');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst currentPage = pages[pages.length - 1];\r\n\t\t\t\tconst currentRoute = currentPage.route;\r\n\r\n\t\t\t\tconsole.log('当前页面路由:', currentRoute);\r\n\r\n\t\t\t\t// 延迟执行，确保用户信息已经完全更新\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// 根据不同页面执行不同的刷新策略\r\n\t\t\t\t\tif (currentRoute === 'pages/index/index') {\r\n\t\t\t\t\t\tconsole.log('刷新index页面数据');\r\n\t\t\t\t\t\tthis.refreshIndexPage(currentPage);\r\n\t\t\t\t\t} else if (currentRoute === 'pages/chargingzhong/chargingzhong') {\r\n\t\t\t\t\t\tconsole.log('刷新chargingzhong页面数据');\r\n\t\t\t\t\t\tthis.refreshChargingzhongPage(currentPage);\r\n\t\t\t\t\t} else if (currentRoute === 'pages/smcharging/smcharging') {\r\n\t\t\t\t\t\tconsole.log('刷新smcharging页面数据');\r\n\t\t\t\t\t\tthis.refreshSmchargingPage(currentPage);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('其他页面，执行通用刷新');\r\n\t\t\t\t\t\tthis.refreshGenericPage(currentPage);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\t\t\t},\r\n\r\n\t\t\t// 刷新index页面\r\n\t\t\trefreshIndexPage(page) {\r\n\t\t\t\tif (page && page.$vm) {\r\n\t\t\t\t\tconsole.log('执行index页面数据刷新');\r\n\t\t\t\t\t// 重新获取用户信息\r\n\t\t\t\t\tif (typeof page.$vm.getUserInfo === 'function') {\r\n\t\t\t\t\t\tpage.$vm.getUserInfo();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 重新初始化页面数据\r\n\t\t\t\t\tif (typeof page.$vm.initPageData === 'function') {\r\n\t\t\t\t\t\tpage.$vm.initPageData();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 重新调用onShow方法\r\n\t\t\t\t\tif (typeof page.$vm.onShow === 'function') {\r\n\t\t\t\t\t\tpage.$vm.onShow();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 强制更新页面\r\n\t\t\t\t\tif (typeof page.$vm.$forceUpdate === 'function') {\r\n\t\t\t\t\t\tpage.$vm.$forceUpdate();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 刷新chargingzhong页面\r\n\t\t\trefreshChargingzhongPage(page) {\r\n\t\t\t\tif (page && page.$vm) {\r\n\t\t\t\t\tconsole.log('执行chargingzhong页面数据刷新');\r\n\t\t\t\t\t// 重新获取用户信息和充电数据\r\n\t\t\t\t\tif (typeof page.$vm.getUserInfo === 'function') {\r\n\t\t\t\t\t\tpage.$vm.getUserInfo();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof page.$vm.getChargingData === 'function') {\r\n\t\t\t\t\t\tpage.$vm.getChargingData();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof page.$vm.initPageData === 'function') {\r\n\t\t\t\t\t\tpage.$vm.initPageData();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 重新调用onShow方法\r\n\t\t\t\t\tif (typeof page.$vm.onShow === 'function') {\r\n\t\t\t\t\t\tpage.$vm.onShow();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 强制更新页面\r\n\t\t\t\t\tif (typeof page.$vm.$forceUpdate === 'function') {\r\n\t\t\t\t\t\tpage.$vm.$forceUpdate();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 刷新smcharging页面\r\n\t\t\trefreshSmchargingPage(page) {\r\n\t\t\t\tif (page && page.$vm) {\r\n\t\t\t\t\tconsole.log('执行smcharging页面数据刷新');\r\n\t\t\t\t\t// 重新初始化页面数据\r\n\t\t\t\t\tif (typeof page.$vm.initPageData === 'function') {\r\n\t\t\t\t\t\tpage.$vm.initPageData();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 重新调用onShow方法\r\n\t\t\t\t\tif (typeof page.$vm.onShow === 'function') {\r\n\t\t\t\t\t\tpage.$vm.onShow();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 强制更新页面\r\n\t\t\t\t\tif (typeof page.$vm.$forceUpdate === 'function') {\r\n\t\t\t\t\t\tpage.$vm.$forceUpdate();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 通用页面刷新\r\n\t\t\trefreshGenericPage(page) {\r\n\t\t\t\tif (page && page.$vm) {\r\n\t\t\t\t\tconsole.log('执行通用页面数据刷新');\r\n\t\t\t\t\t// 尝试调用常见的刷新方法\r\n\t\t\t\t\tif (typeof page.$vm.onShow === 'function') {\r\n\t\t\t\t\t\tpage.$vm.onShow();\r\n\t\t\t\t\t} else if (typeof page.$vm.initPageData === 'function') {\r\n\t\t\t\t\t\tpage.$vm.initPageData();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 强制更新页面\r\n\t\t\t\t\tif (typeof page.$vm.$forceUpdate === 'function') {\r\n\t\t\t\t\t\tpage.$vm.$forceUpdate();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 用户切换后刷新当前页面\r\n\t\t\trefreshCurrentPageAfterUserSwitch() {\r\n\t\t\t\tconsole.log('用户切换后刷新当前页面');\r\n\r\n\t\t\t\t// 验证token是否已更新\r\n\t\t\t\tconst currentToken = uni.getStorageSync('userToken');\r\n\t\t\t\tconst currentUserId = uni.getStorageSync('userId');\r\n\t\t\t\tconsole.log('当前token:', currentToken);\r\n\t\t\t\tconsole.log('当前userId:', currentUserId);\r\n\r\n\t\t\t\tconst pages = getCurrentPages();\r\n\t\t\t\tif (pages.length === 0) {\r\n\t\t\t\t\tconsole.log('没有当前页面，跳过刷新');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst currentPage = pages[pages.length - 1];\r\n\t\t\t\tconst currentRoute = currentPage.route;\r\n\r\n\t\t\t\tconsole.log('当前页面路由:', currentRoute);\r\n\r\n\t\t\t\tif (currentPage && currentPage.$vm) {\r\n\t\t\t\t\t// 增加延迟，确保token完全更新\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t// 再次验证token\r\n\t\t\t\t\t\tconst verifyToken = uni.getStorageSync('userToken');\r\n\t\t\t\t\t\tconsole.log('验证token:', verifyToken);\r\n\r\n\t\t\t\t\t\t// 根据不同页面执行特定的刷新逻辑\r\n\t\t\t\t\t\tif (currentRoute === 'pages/index/index') {\r\n\t\t\t\t\t\t\tconsole.log('刷新index页面用户信息');\r\n\t\t\t\t\t\t\tthis.refreshIndexPageUserInfo(currentPage.$vm);\r\n\t\t\t\t\t\t} else if (currentRoute === 'pages/chargingzhong/chargingzhong') {\r\n\t\t\t\t\t\t\tconsole.log('刷新chargingzhong页面用户信息');\r\n\t\t\t\t\t\t\tthis.refreshChargingzhongPageUserInfo(currentPage.$vm);\r\n\t\t\t\t\t\t} else if (currentRoute === 'pages/smcharging/smcharging') {\r\n\t\t\t\t\t\t\tconsole.log('刷新smcharging页面用户信息');\r\n\t\t\t\t\t\t\tthis.refreshSmchargingPageUserInfo(currentPage.$vm);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 200); // 增加延迟时间\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 刷新index页面用户信息\r\n\t\t\trefreshIndexPageUserInfo(vm) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 重新从本地存储获取用户信息\r\n\t\t\t\t\tconst user = uni.getStorageSync('user');\r\n\t\t\t\t\tconst userToken = uni.getStorageSync('userToken');\r\n\r\n\t\t\t\t\tconsole.log('更新index页面用户信息:', user);\r\n\t\t\t\t\tconsole.log('使用的token:', userToken);\r\n\r\n\t\t\t\t\t// 更新页面的用户信息\r\n\t\t\t\t\tvm.isLoggedIn = !!(userToken && user);\r\n\t\t\t\t\tvm.userlist = user || {};\r\n\r\n\t\t\t\t\t// 延迟调用页面的用户信息更新方法，确保token已更新\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tif (typeof vm.usertap === 'function') {\r\n\t\t\t\t\t\t\tconsole.log('调用index页面usertap方法');\r\n\t\t\t\t\t\t\tvm.usertap();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 100);\r\n\r\n\t\t\t\t\t// 如果有子组件，也要更新子组件\r\n\t\t\t\t\tif (vm.$refs.childComponent && typeof vm.$refs.childComponent.userdetail === 'function') {\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tvm.$refs.childComponent.userdetail();\r\n\t\t\t\t\t\t}, 50);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (vm.$refs.mainindex && typeof vm.$refs.mainindex.userdetail === 'function') {\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tvm.$refs.mainindex.userdetail();\r\n\t\t\t\t\t\t}, 50);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 强制更新页面\r\n\t\t\t\t\tif (typeof vm.$forceUpdate === 'function') {\r\n\t\t\t\t\t\tvm.$forceUpdate();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconsole.log('index页面用户信息刷新完成');\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('刷新index页面用户信息时出错:', error);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 刷新chargingzhong页面用户信息\r\n\t\t\trefreshChargingzhongPageUserInfo(vm) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconsole.log('更新chargingzhong页面用户信息');\r\n\r\n\t\t\t\t\t// 调用页面的刷新方法\r\n\t\t\t\t\tif (typeof vm.onRefresh === 'function') {\r\n\t\t\t\t\t\tvm.onRefresh();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 更新子组件\r\n\t\t\t\t\tif (vm.$refs.childComponent && typeof vm.$refs.childComponent.userdetail === 'function') {\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tvm.$refs.childComponent.userdetail();\r\n\t\t\t\t\t\t}, 50);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 强制更新页面\r\n\t\t\t\t\tif (typeof vm.$forceUpdate === 'function') {\r\n\t\t\t\t\t\tvm.$forceUpdate();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconsole.log('chargingzhong页面用户信息刷新完成');\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('刷新chargingzhong页面用户信息时出错:', error);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 刷新smcharging页面用户信息\r\n\t\t\trefreshSmchargingPageUserInfo(vm) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconsole.log('更新smcharging页面用户信息');\r\n\r\n\t\t\t\t\t// 调用页面的初始化方法\r\n\t\t\t\t\tif (typeof vm.initPageData === 'function') {\r\n\t\t\t\t\t\tvm.initPageData();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 强制更新页面\r\n\t\t\t\t\tif (typeof vm.$forceUpdate === 'function') {\r\n\t\t\t\t\t\tvm.$forceUpdate();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconsole.log('smcharging页面用户信息刷新完成');\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('刷新smcharging页面用户信息时出错:', error);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\r\n\r\n\t\t\t// 强制重新加载当前页面\r\n\t\t\tforceReloadCurrentPage() {\r\n\t\t\t\tconsole.log('强制重新加载当前页面');\r\n\r\n\t\t\t\tconst pages = getCurrentPages();\r\n\t\t\t\tif (pages.length === 0) {\r\n\t\t\t\t\tconsole.log('没有当前页面，跳过重新加载');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst currentPage = pages[pages.length - 1];\r\n\t\t\t\tconst currentRoute = currentPage.route;\r\n\r\n\t\t\t\tconsole.log('当前页面路由:', currentRoute);\r\n\r\n\t\t\t\t// 对于tabBar页面，使用reLaunch重新加载\r\n\t\t\t\tif (currentRoute === 'pages/index/index' ||\r\n\t\t\t\t\tcurrentRoute === 'pages/smcharging/smcharging' ||\r\n\t\t\t\t\tcurrentRoute === 'pages/chargingzhong/chargingzhong') {\r\n\r\n\t\t\t\t\tconsole.log('重新加载tabBar页面:', currentRoute);\r\n\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\turl: '/' + currentRoute\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('非tabBar页面，使用redirectTo重新加载');\r\n\t\t\t\t\t// 获取当前页面的完整路径（包含参数）\r\n\t\t\t\t\tconst fullPath = currentPage.$page ? currentPage.$page.fullPath : ('/' + currentRoute);\r\n\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\turl: fullPath\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 数字补零方法\r\n\t\t\tpad(num, n) {\r\n\t\t\t\tvar len = num.toString().length;\r\n\t\t\t\twhile (len < n) {\r\n\t\t\t\t\tnum = \"0\" + num;\r\n\t\t\t\t\tlen++;\r\n\t\t\t\t}\r\n\t\t\t\treturn num;\r\n\t\t\t},\r\n\r\n\t\t\t// 处理已登录用户的扫码进入\r\n\t\t\thandleLoggedUserScan(deviceId) {\r\n\t\t\t\tconsole.log('处理已登录用户扫码进入，设备ID:', deviceId);\r\n\r\n\t\t\t\t// 保存当前的扫码参数，防止被其他地方清除\r\n\t\t\t\tconst currentScanParams = this.globalData.scanParams ? { ...this.globalData.scanParams } : null;\r\n\t\t\t\tconsole.log('保存当前扫码参数:', currentScanParams);\r\n\r\n\t\t\t\t// 获取当前登录code\r\n\t\t\t\tuni.login({\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconsole.log('获取登录code成功:', res.code);\r\n\r\n\t\t\t\t\t\t// 构造登录参数\r\n\t\t\t\t\t\tconst data = {\r\n\t\t\t\t\t\t\tcode: res.code,\r\n\t\t\t\t\t\t\tdeviceId: deviceId // 添加设备ID参数\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tconsole.log('调用wxlogin/applet接口，参数:', data);\r\n\r\n\t\t\t\t\t\t// 调用登录接口（不需要手机号授权）\r\n\t\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\t\turl: Config.api + 'wxlogin/applet',\r\n\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: (response) => {\r\n\t\t\t\t\t\t\t\tconsole.log('wxlogin/applet接口调用成功:', response);\r\n\r\n\t\t\t\t\t\t\t\tif (response.data && response.data.code == 200) {\r\n\t\t\t\t\t\t\t\t\tconst newUserData = response.data.data;\r\n\t\t\t\t\t\t\t\t\tconst currentUserId = uni.getStorageSync('userId');\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.log('当前用户ID:', currentUserId);\r\n\t\t\t\t\t\t\t\t\tconsole.log('新用户ID:', newUserData.id);\r\n\r\n\t\t\t\t\t\t\t\t\t// 比较userId，如果不同则清除所有用户相关信息，相当于新用户登录\r\n\t\t\t\t\t\t\t\t\tif (currentUserId && currentUserId !== newUserData.id) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('检测到不同用户，清除旧用户信息，切换到新用户');\r\n\r\n\t\t\t\t\t\t\t\t\t\t// 清除所有用户相关的本地存储\r\n\t\t\t\t\t\t\t\t\t\tthis.clearUserRelatedStorage(currentUserId);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('相同用户或首次登录，更新用户信息');\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// 设置新用户信息\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('user', newUserData);\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('userId', newUserData.id);\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('userToken', newUserData.token);\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('phone', newUserData.phone);\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('Name', newUserData.realName);\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('poster', newUserData.poster);\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('adunit', newUserData.adunit);\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.log('新用户token已保存:', newUserData.token);\r\n\r\n\t\t\t\t\t\t\t\t\t// 设置新用户的特定存储项\r\n\t\t\t\t\t\t\t\t\tvar logolist = \"logolist_\" + newUserData.id;\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync(logolist, \"\");\r\n\t\t\t\t\t\t\t\t\tvar usertype = 'type_' + newUserData.id;\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync(usertype, newUserData.scan);\r\n\r\n\t\t\t\t\t\t\t\t\t// 处理海报列表\r\n\t\t\t\t\t\t\t\t\tif (newUserData.posterList) {\r\n\t\t\t\t\t\t\t\t\t\tvar posterList = newUserData.posterList;\r\n\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < posterList.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\tposterList[i].img = Config.imgapi + posterList[i].img.replace(\"/tabBarimg\", \"\");\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('posterList', posterList);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('posterList', []);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.log('用户信息已更新完成，扫码参数已保存');\r\n\r\n\t\t\t\t\t\t\t\t\t// 如果检测到用户切换，立即跳转到充电页面\r\n\t\t\t\t\t\t\t\t\tif (currentUserId && currentUserId !== newUserData.id) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('用户已切换，立即跳转到充电页面');\r\n\r\n\t\t\t\t\t\t\t\t\t\t// 构造充电页面URL\r\n\t\t\t\t\t\t\t\t\t\tif (currentScanParams && currentScanParams.device && currentScanParams.port) {\r\n\t\t\t\t\t\t\t\t\t\t\t// 处理端口号转换\r\n\t\t\t\t\t\t\t\t\t\t\tlet processedPort = '';\r\n\t\t\t\t\t\t\t\t\t\t\tif (currentScanParams.port.toUpperCase() !== 'FF') {\r\n\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tprocessedPort = this.pad(parseInt(currentScanParams.port, 16).toString(10), 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('端口号转换错误:', e);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tprocessedPort = currentScanParams.port;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tprocessedPort = currentScanParams.port;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconst chargeUrl = `/pageone/poweron/poweron?device=${currentScanParams.device}&port=${processedPort}&cmd=0&from=1`;\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('跳转到充电页面:', chargeUrl);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// 延迟跳转，确保用户信息已经完全更新\r\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('用户切换，跳转到充电页面:', chargeUrl);\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\turl: chargeUrl,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('用户切换后跳转充电页面成功');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('跳转充电页面失败:', err);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}, 200);\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('没有扫码参数，无法跳转到充电页面');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('相同用户，无需跳转');\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (response.data && response.data.code == 599) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('已登录用户扫码时未关注公众号，跳转到登录页面处理');\r\n\r\n\t\t\t\t\t\t\t\t\t// 构造跳转URL，保留设备号和端口号参数\r\n\t\t\t\t\t\t\t\t\tlet loginUrl = '/pages/login/login?reason=follow_wechat';\r\n\t\t\t\t\t\t\t\t\tif (currentScanParams && currentScanParams.device && currentScanParams.port) {\r\n\t\t\t\t\t\t\t\t\t\tloginUrl += `&device=${currentScanParams.device}&port=${currentScanParams.port}`;\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('保留设备参数跳转到登录页面:', currentScanParams);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// 清除扫码参数，避免重复处理\r\n\t\t\t\t\t\t\t\t\tthis.globalData.scanParams = null;\r\n\r\n\t\t\t\t\t\t\t\t\t// 跳转到登录页面，让登录页面处理关注引导\r\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\t\t\t\t\turl: loginUrl,\r\n\t\t\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('跳转到登录页面成功');\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('跳转到登录页面失败:', err);\r\n\t\t\t\t\t\t\t\t\t\t\t\t// 如果reLaunch失败，尝试使用redirectTo\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('尝试使用redirectTo跳转');\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\turl: loginUrl,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('redirectTo跳转成功');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfail: (err2) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('redirectTo也失败:', err2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}, 100);\r\n\t\t\t\t\t\t\t\t} else if (response.data && response.data.code == 598) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('已登录用户扫码时需要重新授权手机号，跳转到登录页面');\r\n\t\t\t\t\t\t\t\t\tconsole.log('保存的扫码参数:', currentScanParams);\r\n\r\n\t\t\t\t\t\t\t\t\t// 构造跳转URL，保留设备号和端口号参数\r\n\t\t\t\t\t\t\t\t\tlet loginUrl = '/pages/login/login?reason=phone_auth';\r\n\t\t\t\t\t\t\t\t\tif (currentScanParams && currentScanParams.device && currentScanParams.port) {\r\n\t\t\t\t\t\t\t\t\t\tloginUrl += `&device=${currentScanParams.device}&port=${currentScanParams.port}`;\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('保留设备参数跳转到登录页面:', currentScanParams);\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('构造的跳转URL:', loginUrl);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('没有设备参数，使用基础URL:', loginUrl);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// 清除扫码参数，避免重复处理\r\n\t\t\t\t\t\t\t\t\tthis.globalData.scanParams = null;\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.log('准备跳转到登录页面，URL:', loginUrl);\r\n\t\t\t\t\t\t\t\t\t// 跳转到登录页面，让登录页面处理手机号授权\r\n\t\t\t\t\t\t\t\t\t// 使用setTimeout延迟跳转，避免在接口回调中立即跳转导致的问题\r\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\t\t\t\t\turl: loginUrl,\r\n\t\t\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('跳转到登录页面成功');\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('跳转到登录页面失败:', err);\r\n\t\t\t\t\t\t\t\t\t\t\t\t// 如果reLaunch失败，尝试使用redirectTo\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('尝试使用redirectTo跳转');\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\turl: loginUrl,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('redirectTo跳转成功');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfail: (err2) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('redirectTo也失败:', err2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}, 100);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconsole.log('wxlogin/applet接口返回失败:', response.data);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (error) => {\r\n\t\t\t\t\t\t\t\tconsole.error('wxlogin/applet接口调用失败:', error);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (error) => {\r\n\t\t\t\t\t\tconsole.error('获取登录code失败:', error);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t@import “/wxcomponents/vant/index.wxss”;\r\n\t.boby{\r\n\t\t/* background-color: #FFFFFF; */\r\n\t\t/* text-size-adjust: 100% !important;\r\n\t\t-webkit-text-size-adjust: 100% !important;\r\n\t\t-moz-text-size-adjust: 100% !important; */\r\n\r\n\t}\r\n\t/deep/.van-dialog__footer{\r\n\t\tdisplay: flex!important;\r\n\t}\r\n\t/deep/.van-toast{\r\n\t\twidth: 200upx;\r\n\t\tmax-width: 100%;\r\n\t}\r\n\t/deep/.redtrip{\r\n\t\tcolor: red;\r\n\t}\r\n\r\n\r\n\r\n\r\n\t/*每个页面公共css */\r\n</style>\r\n","import mod from \"-!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.4.24.2024072208\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./App.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1749174613875\n      var cssReload = require(\"D:/软件/HBuilderX.4.24.2024072208/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}